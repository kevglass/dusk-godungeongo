var t=Object.defineProperty,i=(i,e,s)=>(((i,e,s)=>{e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s})(i,"symbol"!=typeof e?e+"":e,s),s);import{E as e,D as s,f as o,a as h}from"../logic.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();const n=new AudioContext;function l(){n.resume()}n.resume();const r=document.getElementById("gamecanvas"),a=r.getContext("2d");let d,c=!1;function g(){return r.width}function A(){return r.height}function m(t){const i=new Image;return i.src=t,i}function f(t,i,e){const s=new Image;return s.src=t,{image:s,tileWidth:i,tileHeight:e}}function u(t,i,e,s,o=t.tileWidth,h=t.tileHeight){const n=Math.floor(t.image.width/t.tileWidth),l=s%n*t.tileWidth,r=Math.floor(s/n)*t.tileHeight;a.drawImage(t.image,l,r,t.tileWidth,t.tileHeight,i,e,o,h)}function p(t,i,e,s,o){a.fillStyle=o,a.font="bold "+s+'px "Fira Sans", sans-serif',a.fillText(e,t,i)}function y(t,i,e,s,o){a.fillStyle=o,a.fillRect(t,i,e,s)}function w(t,i,e,s,o){a.drawImage(t,i,e,s,o)}function b(){a.save()}function M(){a.restore()}function I(t){a.globalAlpha=t}function v(t,i){a.translate(t,i)}function P(t,i){a.scale(t,i)}function S(t,i,e,s){a.fillStyle=s,a.beginPath(),a.arc(t,i,e,0,2*Math.PI),a.fill()}a.imageSmoothingEnabled=!1,r.style.imageRendering="pixelated",document.addEventListener("contextmenu",(t=>{t.preventDefault()})),r.addEventListener("touchstart",(t=>{l();for(const i of t.changedTouches)null==d||d.mouseDown(i.clientX,i.clientY,i.identifier);t.stopPropagation()})),window.addEventListener("keydown",(t=>{null==d||d.keyDown(t.key)})),window.addEventListener("keyup",(t=>{null==d||d.keyUp(t.key)})),r.addEventListener("touchend",(t=>{l();for(const i of t.changedTouches)null==d||d.mouseUp(i.clientX,i.clientY,i.identifier);t.stopPropagation()})),r.addEventListener("touchmove",(t=>{l();for(const i of t.changedTouches)null==d||d.mouseDrag(i.clientX,i.clientY,i.identifier);t.stopPropagation()})),r.addEventListener("mousedown",(t=>{l(),null==d||d.mouseDown(t.x,t.y,t.button),c=!0,t.stopPropagation()})),r.addEventListener("mousemove",(t=>{l(),c&&(null==d||d.mouseDrag(t.x,t.y,t.button),t.stopPropagation())})),r.addEventListener("mouseup",(t=>{l(),null==d||d.mouseUp(t.x,t.y,t.button),t.stopPropagation()}));var z=""+new URL("tileset-e531bb7b.png",import.meta.url).href,N=""+new URL("dpad-ff7e07fd.png",import.meta.url).href;function L(t,i,e,s,o,h){return t>=e&&i>=s&&t<e+o&&i<s+h}const H=250,C=["rgba(255,255,255,0.5)","rgba(230,230,230,0.5)","rgba(200,200,200,0.5)","rgba(180,180,180,0.5)"],G=["rgba(100,100,255,0.7)","rgba(100,100,230,0.7)","rgba(100,100,200,0.7)","rgba(100,100,180,0.7)"];class R{constructor(){i(this,"frame",0),i(this,"interpolator"),i(this,"lastFrames",[]),i(this,"lastX",-1),i(this,"lastY",-1),this.interpolator=Rune.interpolatorLatency({maxSpeed:15})}update(t){this.lastX===t.x&&this.lastY===t.y||(this.lastFrames.push({x:(t.x+this.lastX)/2,y:(t.y+this.lastY)/2,dieAt:Rune.gameTime()+H,size:5+Math.floor(7*Math.random()),offset:-1+Math.floor(3*Math.random()),speedCol:G[Math.floor(Math.random()*C.length)],col:C[Math.floor(Math.random()*C.length)]}),this.lastFrames.push({x:t.x,y:t.y,dieAt:Rune.gameTime()+H,size:5+Math.floor(7*Math.random()),offset:-1+Math.floor(3*Math.random()),speedCol:G[Math.floor(Math.random()*C.length)],col:C[Math.floor(Math.random()*C.length)]})),this.lastFrames=this.lastFrames.filter((t=>t.dieAt>Rune.gameTime())),this.lastX=t.x,this.lastY=t.y}}class E{constructor(){i(this,"discovered",!1),i(this,"fade",0)}}(new class{constructor(){i(this,"tiles"),i(this,"dpad"),i(this,"button"),i(this,"game"),i(this,"joined",!1),i(this,"controlSize",0),i(this,"controlHorizontalPadding",0),i(this,"controlVerticalPadding",0),i(this,"playerId"),i(this,"viewX",0),i(this,"viewY",0),i(this,"touchInDpad",-1),i(this,"left",!1),i(this,"right",!1),i(this,"down",!1),i(this,"up",!1),i(this,"entitySprites",{}),i(this,"localRooms",{}),i(this,"players"),i(this,"avatarImages",{}),this.tiles=f(z,32,32),this.dpad=f(N,80,80),this.button=f("data:image/png;base64,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",80,80)}start(){d=this,Rune.initClient({onChange:t=>{this.gameUpdate(t)}}),requestAnimationFrame((()=>{this.loop()}))}gameUpdate(t){var i;this.game=t.game,this.playerId=t.yourPlayerId,this.players=t.players;for(const i in t.players)this.avatarImages[i]||(this.avatarImages[i]=m(t.players[i].avatarUrl));for(const e of this.game.entities){let s=this.entitySprites[e.id];s||(s=this.entitySprites[e.id]=new R);const o=e.id===t.yourPlayerId?e:null==(i=t.futureGame)?void 0:i.entities.find((t=>t.id===e.id));o&&s.interpolator.update({game:[e.x,e.y],futureGame:[o.x,o.y]})}const e=Object.keys(this.entitySprites).filter((t=>{var i;return!(null==(i=this.game)?void 0:i.entities.find((i=>i.id===t)))}));for(const t of e)delete this.entitySprites[t];for(const t of this.game.rooms){let i=this.localRooms[t.id];i||(i=this.localRooms[t.id]=new E)}}processDPad(t,i){if(this.game){const e=A()-this.controlSize/2-this.controlVerticalPadding,s=t-(this.controlHorizontalPadding+this.controlSize/2),o=i-e;let h=!1,n=!1,l=!1,r=!1;Math.abs(s)>this.controlSize/4?(h=s<0,n=s>0):(h=!1,n=!1),Math.abs(o)>this.controlSize/4?(r=o<0,l=o>0):(r=!1,l=!1);const a=this.game.entities.find((t=>t.id===this.playerId));!a||a.controls.left===h&&a.controls.right===n&&a.controls.up===r&&a.controls.down===l||Rune.actions.applyControls({left:h,right:n,up:r,down:l})}}mouseDown(t,i,e){if(this.joined){const s=A()-this.controlSize-this.controlVerticalPadding;L(t,i,this.controlHorizontalPadding,s,this.controlSize,this.controlSize)&&(this.touchInDpad=e,this.processDPad(t,i)),L(t,i,g()-this.controlSize-this.controlHorizontalPadding,s,this.controlSize,this.controlSize)&&Rune.actions.useItem()}}mouseDrag(t,i,e){this.joined&&e===this.touchInDpad&&this.processDPad(t,i)}mouseUp(t,i,s){if(this.joined){if(s===this.touchInDpad&&(this.touchInDpad=-1,this.game)){this.game.entities.find((t=>t.id===this.playerId))&&Rune.actions.applyControls({left:!1,right:!1,up:!1,down:!1})}}else Rune.actions.join({type:e.KNIGHT}),this.joined=!0}keyDown(t){if(this.game){const i=this.game.entities.find((t=>t.id===this.playerId));i&&("ArrowLeft"===t&&(this.left=!0),"ArrowRight"===t&&(this.right=!0),"ArrowUp"===t&&(this.up=!0),"ArrowDown"===t&&(this.down=!0),i.controls.left===this.left&&i.controls.right===this.right&&i.controls.up===this.up&&i.controls.down===this.down||Rune.actions.applyControls({left:this.left,right:this.right,up:this.up,down:this.down})," "===t&&Rune.actions.useItem())}}keyUp(t){if(this.game){const i=this.game.entities.find((t=>t.id===this.playerId));i&&("ArrowLeft"===t&&(this.left=!1),"ArrowRight"===t&&(this.right=!1),"ArrowUp"===t&&(this.up=!1),"ArrowDown"===t&&(this.down=!1),i.controls.left===this.left&&i.controls.right===this.right&&i.controls.up===this.up&&i.controls.down===this.down||Rune.actions.applyControls({left:this.left,right:this.right,up:this.up,down:this.down}))}}drawRoom(t){let i;this.game&&(i=this.game.entities.find((t=>t.id===this.playerId))),b(),v(32*t.x,32*t.y);for(let i=0;i<t.width;i++)for(let e=0;e<t.height;e++)u(this.tiles,32*i,32*e,64);for(let i=1;i<t.width-1;i++)u(this.tiles,32*i,-32,0),u(this.tiles,32*i,0,16),u(this.tiles,32*i,32*t.height-32,0),u(this.tiles,32*i,32*t.height,16);for(let i=1;i<t.height-1;i++)u(this.tiles,0,32*i,129),u(this.tiles,32*t.width-32,32*i,128);u(this.tiles,0,-32,114),u(this.tiles,0,0,130),u(this.tiles,32*t.width-32,-32,115),u(this.tiles,32*t.width-32,0,131),u(this.tiles,0,32*t.height-32,146),u(this.tiles,0,32*t.height,162),u(this.tiles,32*t.width-32,32*t.height-32,147),u(this.tiles,32*t.width-32,32*t.height,163);const e=Math.floor(t.width/2)-1,o=Math.floor(t.height/2)-1,h=(null==i?void 0:i.bronzeKey)&&(null==i?void 0:i.goldKey)&&(null==i?void 0:i.silverKey);t.connections[s.NORTH]&&(u(this.tiles,32*e,0,64),u(this.tiles,32*(e+1),0,64),u(this.tiles,32*e,-32,64),u(this.tiles,32*(e+1),-32,64),u(this.tiles,32*(e-1),-32,128),u(this.tiles,32*(e+2),-32,129),t.doors[s.NORTH]&&(h&&I(.5),u(this.tiles,32*e,-32,12),u(this.tiles,32*(e+1),-32,13),I(1))),t.connections[s.SOUTH]&&(u(this.tiles,32*e,32*t.height-32,64),u(this.tiles,32*(e+1),32*t.height-32,64),u(this.tiles,32*e,32*t.height,64),u(this.tiles,32*(e+1),32*t.height,64),u(this.tiles,32*(e-1),32*t.height,128),u(this.tiles,32*(e+2),32*t.height,129),t.doors[s.SOUTH]&&(h&&I(.5),u(this.tiles,32*e,32*t.height+32,12),u(this.tiles,32*(e+1),32*t.height+32,13),I(1))),t.connections[s.WEST]&&(u(this.tiles,0,32*o,64),u(this.tiles,0,32*o+32,64),u(this.tiles,-32,32*o,64),u(this.tiles,-32,32*o+32,64),u(this.tiles,-32,32*o-32,16),u(this.tiles,0,32*o-32,145),u(this.tiles,-32,32*o-64,0),u(this.tiles,-32,32*o+38,0),u(this.tiles,-32,32*o+70,16),t.doors[s.WEST]&&(h&&I(.5),u(this.tiles,-48,32*o-31,14),u(this.tiles,-48,32*o+1,30),u(this.tiles,-48,32*o+33,46),I(1))),t.connections[s.EAST]&&(u(this.tiles,32*t.width,32*o,64),u(this.tiles,32*t.width,32*o+32,64),u(this.tiles,32*t.width-32,32*o,64),u(this.tiles,32*t.width-32,32*o+32,64),u(this.tiles,32*t.width,32*o-32,16),u(this.tiles,32*t.width-32,32*o-32,144),u(this.tiles,32*t.width,32*o-64,0),u(this.tiles,32*t.width,32*o+38,0),u(this.tiles,32*t.width,32*o+70,16),t.doors[s.EAST]&&(h&&I(.5),u(this.tiles,32*t.width+16,32*o-31,14),u(this.tiles,32*t.width+16,32*o+1,30),u(this.tiles,32*t.width+16,32*o+33,46),I(1))),"treasure"===t.item&&u(this.tiles,Math.floor(16*(t.width-1)),Math.floor(16*(t.height-1)),6),"speed"===t.item&&u(this.tiles,Math.floor(16*(t.width-1)),Math.floor(16*(t.height-1)),28),"health"===t.item&&u(this.tiles,Math.floor(16*(t.width-1)),Math.floor(16*(t.height-1)),27),"bronze"!==t.item||(null==i?void 0:i.bronzeKey)||u(this.tiles,Math.floor(16*(t.width-1)),Math.floor(16*(t.height-1)),11),"silver"!==t.item||(null==i?void 0:i.silverKey)||u(this.tiles,Math.floor(16*(t.width-1)),Math.floor(16*(t.height-1)),10),"gold"!==t.item||(null==i?void 0:i.goldKey)||u(this.tiles,Math.floor(16*(t.width-1)),Math.floor(16*(t.height-1)),9),"egg"===t.item&&(u(this.tiles,Math.floor(16*(t.width-1)),Math.floor(16*(t.height-1))-32,22),u(this.tiles,Math.floor(16*(t.width-1)),Math.floor(16*(t.height-1)),38)),M()}loop(){if(this.controlSize=g()/5,this.controlHorizontalPadding=this.controlSize/2,this.controlVerticalPadding=.7*this.controlSize,r.width=window.innerWidth,r.height=window.innerHeight,this.game&&this.joined){const r=this.game.entities.find((t=>t.id===this.playerId));if(r){this.viewX=r.x-g()/2,this.viewY=r.y-.4*A();for(const t of o(this.game,r.x,r.y)){this.localRooms[t.id].discovered=!0}}for(const t of Object.values(this.localRooms))t.discovered&&t.fade<1&&(t.fade+=.1);b(),v(-this.viewX,-this.viewY);for(const t of this.game.rooms){if(r){const i=Math.abs(32*t.x-r.x),e=Math.abs(32*t.y-r.y);if(i>2*g()||e>2*A())continue}const i=this.localRooms[t.id];i&&i.discovered&&(I(i.fade),this.drawRoom(t),I(1))}for(const t of this.game.entities){const i=h(this.game,t.x,t.y);if(i){const s=this.localRooms[i.id];if(s&&s.discovered){const i=this.entitySprites[t.id];i.update(t),i.frame+=.1,i.frame>=t.anim.count&&(i.frame=0),b();for(const s of i.lastFrames){const i=s.dieAt-Rune.gameTime();if(i>225)continue;I(i/H),e=s.x-s.offset,n=s.y-s.offset,l=s.size,d=t.speed>10?s.speedCol:s.col,a.fillStyle=d,a.beginPath(),a.arc(e,n,l,Math.PI,0),a.fill(),I(1)}v(i.interpolator.getPosition()[0]-16,i.interpolator.getPosition()[1]-32),t.faceLeft&&(P(-1,1),v(-32,0)),u(this.tiles,0,-32,t.type+Math.floor(t.anim.base+i.frame)),u(this.tiles,0,0,t.type+16+Math.floor(t.anim.base+i.frame)),M()}}}if(M(),this.game&&!this.game.atStart){b();const t=this.game.entities.find((t=>t.id===this.playerId));if(t){P(1.5,1.5),y(0,0,84,84,"rgba(0,0,0,0.5)"),v(42,42);for(const t of this.game.rooms)if(t.discovered){let i="rgba(255,255,255,0.5)";"bronze"===t.item&&(i="rgba(255,155,0,0.8)"),"silver"===t.item&&(i="rgba(240,240,255,0.8)"),"gold"===t.item&&(i="rgba(255,255,0,0.8)"),y(t.x,t.y,t.width,t.height,i),t.connections[s.NORTH]&&y(t.x+t.width/2-2,t.y-2,4,2,t.doors[s.NORTH]?"rgb(255,255,0)":"rgb(200,200,200)"),t.connections[s.SOUTH]&&y(t.x+t.width/2-2,t.y+t.height,4,2,t.doors[s.SOUTH]?"rgb(255,255,0)":"rgb(200,200,200)"),t.connections[s.WEST]&&y(t.x-2,t.y+t.height/2-2,2,4,t.doors[s.WEST]?"rgb(255,255,0)":"rgb(200,200,200)"),t.connections[s.EAST]&&y(t.x+t.width,t.y+t.height/2-2,2,4,t.doors[s.EAST]?"rgb(255,255,0)":"rgb(200,200,200)")}for(const i of this.game.entities){const e=h(this.game,i.x,i.y);if(e&&e.discovered){this.localRooms[e.id]&&S(Math.floor(i.x/32),Math.floor(i.y/32),1.5,i===t?"white":"black")}}}M()}if(b(),v(0,A()-this.controlSize-this.controlVerticalPadding),u(this.dpad,this.controlHorizontalPadding,0,0,this.controlSize,this.controlSize),u(this.button,g()-this.controlSize-this.controlHorizontalPadding,0,0,this.controlSize,this.controlSize),this.game){const t=this.game.entities.find((t=>t.id===this.playerId));if(t){const i=(this.controlSize-32)/2;"speed"===t.item&&u(this.tiles,g()-this.controlSize-this.controlHorizontalPadding+i,i,28),"health"===t.item&&u(this.tiles,g()-this.controlSize-this.controlHorizontalPadding+i,i,27)}}if(M(),this.game&&this.players&&this.game.atStart){let e=0;const s=[];for(const t in this.game.scores)s.push({...this.players[t],score:this.game.scores[t]});s.sort(((t,i)=>i.score-t.score));for(const o of s)y(0,1+34*e,g(),32,e%2==0?"rgba(255,255,255,0.2)":"rgba(255,255,255,0.1)"),w(this.avatarImages[o.playerId],0,34*e+1,32,32),p(40,25+34*e,o.displayName,20,"white"),p(g()-(t=""+o.score,i=20,a.font="bold "+i+'px "Fira Sans", sans-serif',a.measureText(t).width)-20,25+34*e,""+o.score,20,"white"),e++}if(this.game&&!this.game.atStart){const t=this.game.entities.find((t=>t.id===this.playerId));if(t){let i=16;t.bronzeKey&&(u(this.tiles,g()-i,34,47),i+=16),t.silverKey&&(u(this.tiles,g()-i,34,31),i+=16),t.goldKey&&(u(this.tiles,g()-i,34,15),i+=16);for(let i=0;i<3;i++)u(this.tiles,g()-32-32*i,0,i<t.health?7:8)}}}var t,i,e,n,l,d;requestAnimationFrame((()=>{this.loop()}))}}).start();